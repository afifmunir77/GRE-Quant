<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRE Quant Practice</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font as requested */
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.6;
        }
        h1 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        .question-container {
            background-color: #fff;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 12px; /* Rounded corners */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        .question-text {
            font-size: 1.15em;
            margin-bottom: 25px;
            font-weight: 500;
        }
        .options label {
            display: block;
            margin-bottom: 12px;
            font-size: 1em;
            cursor: pointer;
            padding: 8px 10px;
            border-radius: 8px;
            transition: background-color 0.2s, color 0.2s;
        }
        .options label:hover {
            background-color: #e0f7fa;
            color: #007bff;
        }
        .options input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.1);
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
            background-color: #007bff;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        button:active {
            transform: translateY(0);
        }
        .answer-feedback {
            margin-top: 20px;
            font-weight: bold;
            font-size: 1.1em;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
        }
        .correct {
            color: #28a745;
            background-color: #e6ffe6;
        }
        .incorrect {
            color: #dc3545;
            background-color: #ffe6e6;
        }
        .timer-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f0f8ff;
            border-radius: 10px;
            display: flex;
            flex-direction: column; /* Stack elements vertically on small screens */
            align-items: center;
            gap: 15px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        @media (min-width: 600px) {
            .timer-section {
                flex-direction: row; /* Horizontal layout on larger screens */
                justify-content: center;
            }
        }
        .timer-display {
            font-size: 1.8em;
            font-weight: bold;
            min-width: 120px;
            text-align: center;
            padding: 5px 10px;
            border: 2px solid #a7d9ff;
            border-radius: 8px;
            background-color: #ffffff;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .negative-time {
            color: red;
        }
        .timer-buttons button {
            padding: 10px 18px;
            margin: 0 5px;
            border-radius: 8px;
            font-size: 0.95em;
        }
        .timer-buttons button.start-btn {
            background-color: #28a745;
        }
        .timer-buttons button.start-btn:hover {
            background-color: #218838;
        }
        .timer-buttons button.stop-btn {
            background-color: #dc3545;
        }
        .timer-buttons button.stop-btn:hover {
            background-color: #c82333;
        }
        .timer-buttons button.reset-btn {
            background-color: #6c757d;
        }
        .timer-buttons button.reset-btn:hover {
            background-color: #5a6268;
        }
        .timer-type-toggle {
            display: flex;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #007bff;
        }
        .timer-type-toggle button {
            padding: 8px 15px;
            border: none; /* Individual button borders removed, handled by container */
            background-color: white;
            color: #007bff;
            cursor: pointer;
            font-size: 0.9em;
            border-radius: 0;
            transition: background-color 0.2s, color 0.2s;
            box-shadow: none; /* Remove individual button shadow */
        }
        .timer-type-toggle button.active {
            background-color: #007bff;
            color: white;
        }
        .timer-type-toggle button:hover:not(.active) {
            background-color: #e0f7fa;
        }
        .timer-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1em;
            color: #555;
        }
        .timer-input-group input {
            width: 50px;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            text-align: center;
            font-size: 1em;
        }
        .progress-section {
            margin-top: 40px;
            padding: 25px;
            background-color: #e0f7fa;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        .progress-section h3 {
            margin-top: 0;
            color: #007bff;
            font-size: 1.8em;
            text-align: center;
            margin-bottom: 20px;
        }
        .progress-item {
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px dashed #b3e5fc;
            font-size: 0.95em;
        }
        .progress-item:last-child {
            border-bottom: none;
        }
        .progress-item strong {
            color: #0056b3;
        }
        .progress-item .time-taken {
            color: #28a745;
            font-weight: bold;
        }
        .progress-item .negative-time-taken {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>GRE Quant Practice Questions</h1>

    <div id="questions-container">
        <!-- Questions will be dynamically loaded here by JavaScript -->
    </div>

    <div class="progress-section">
        <h3>Your Progress</h3>
        <div id="progress-list">
            <!-- Progress items will be loaded here from local storage -->
        </div>
    </div>

    <script>
        // Array to hold all questions and their correct answers
        const allQuestions = [
            {
                id: 'question1',
                text: 'Liam is 5 years older than Olivia. In 3 years, Liam will be twice as old as Olivia. How old is Olivia now?',
                options: {
                    A: '2',
                    B: '7',
                    C: '8',
                    D: '10',
                    E: '12'
                },
                correctAnswer: 'A' // Correct answer for question1
            }
            // Add more questions here as objects
        ];

        const timers = {}; // Stores the current time for each timer (in seconds)
        const timerIntervals = {}; // Stores the setInterval ID for each timer
        const timerTypes = {}; // Stores the type ('stopwatch' or 'timer') for each question
        const timerSetTimes = {}; // Stores the *initial* set time for 'timer' type countdown

        // Function to render questions dynamically
        function renderQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = ''; // Clear existing content

            allQuestions.forEach(q => {
                let optionsHtml = '';
                for (const key in q.options) {
                    optionsHtml += `
                        <label>
                            <input type="radio" name="${q.id}_option" value="${key}"> ${key}) ${q.options[key]}
                        </label>
                    `;
                }

                container.innerHTML += `
                    <div class="question-container" id="${q.id}">
                        <div class="question-text">
                            <p>${q.text}</p>
                        </div>
                        <div class="options">
                            ${optionsHtml}
                        </div>
                        <button onclick="checkAnswer('${q.id}', '${q.correctAnswer}')">Check Answer</button>
                        <div class="answer-feedback" id="feedback-${q.id}"></div>

                        <div class="timer-section">
                            <div class="timer-type-toggle">
                                <button id="toggle-stopwatch-${q.id}" class="active" onclick="toggleTimerType('${q.id}', 'stopwatch')">Stopwatch</button>
                                <button id="toggle-timer-${q.id}" onclick="toggleTimerType('${q.id}', 'timer')">Timer</button>
                            </div>
                            <div class="timer-input-group" id="timer-input-${q.id}" style="display: none;">
                                <input type="number" id="timer-minutes-${q.id}" value="1" min="0"> min
                                <input type="number" id="timer-seconds-${q.id}" value="0" min="0" max="59"> sec
                            </div>
                            <div class="timer-display" id="timer-display-${q.id}">00:00</div>
                            <div class="timer-buttons">
                                <button class="start-btn" onclick="startTimer('${q.id}')">Start</button>
                                <button class="stop-btn" onclick="stopTimer('${q.id}')">Stop</button>
                                <button class="reset-btn" onclick="resetTimer('${q.id}')">Reset</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Load progress from local storage when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            renderQuestions(); // FIRST: Render all questions
            loadProgress(); // THEN: Load progress (depends on questions existing)

            // FINALLY: Initialize timer types for all questions that have been rendered
            document.querySelectorAll('.question-container').forEach(q => {
                const questionId = q.id;
                toggleTimerType(questionId, 'stopwatch'); // Default to stopwatch on load
            });
        });

        function checkAnswer(questionId, correctAnswer) {
            const options = document.querySelectorAll(`#${questionId} input[name="${questionId}_option"]`);
            let selectedValue = null;
            options.forEach(option => {
                if (option.checked) {
                    selectedValue = option.value;
                }
            });

            const feedbackDiv = document.getElementById(`feedback-${questionId}`);
            if (selectedValue === correctAnswer) {
                feedbackDiv.textContent = "Correct!";
                feedbackDiv.className = "answer-feedback correct";
                saveProgress(questionId, true);
            } else {
                feedbackDiv.textContent = "Incorrect. Try again!";
                feedbackDiv.className = "answer-feedback incorrect";
                saveProgress(questionId, false);
            }
        }

        function toggleTimerType(questionId, type) {
            timerTypes[questionId] = type;
            const stopwatchBtn = document.getElementById(`toggle-stopwatch-${questionId}`);
            const timerBtn = document.getElementById(`toggle-timer-${questionId}`);
            const timerInput = document.getElementById(`timer-input-${questionId}`);
            const timerDisplay = document.getElementById(`timer-display-${questionId}`);

            // Ensure elements exist before trying to manipulate them
            if (!stopwatchBtn || !timerBtn || !timerInput || !timerDisplay) {
                console.error(`Elements for ${questionId} not found during toggleTimerType.`);
                return;
            }

            stopTimer(questionId); // Stop any running timer when changing type
            resetTimer(questionId); // Reset the timer display and value

            if (type === 'stopwatch') {
                stopwatchBtn.classList.add('active');
                timerBtn.classList.remove('active');
                timerInput.style.display = 'none';
                timerDisplay.classList.remove('negative-time'); // Ensure no red color for stopwatch
            } else { // Timer mode
                timerBtn.classList.add('active');
                stopwatchBtn.classList.remove('active');
                timerInput.style.display = 'flex';
                // Set initial display based on input values
                const minutesInput = document.getElementById(`timer-minutes-${questionId}`);
                const secondsInput = document.getElementById(`timer-seconds-${questionId}`);
                const minutes = parseInt(minutesInput.value || 0);
                const seconds = parseInt(secondsInput.value || 0);
                const totalSeconds = minutes * 60 + seconds;
                timerSetTimes[questionId] = totalSeconds; // Store for calculating time taken
                timers[questionId] = totalSeconds; // Set current timer value
                timerDisplay.textContent = formatTime(totalSeconds);
            }
        }

        function startTimer(questionId) {
            if (timerIntervals[questionId]) return; // Timer already running

            const timerDisplay = document.getElementById(`timer-display-${questionId}`);
            if (!timerDisplay) {
                console.error(`Timer display for ${questionId} not found.`);
                return;
            }
            timerDisplay.classList.remove('negative-time');

            // Ensure timer type is set, default to stopwatch if not
            if (!timerTypes[questionId]) {
                toggleTimerType(questionId, 'stopwatch');
            }

            if (timerTypes[questionId] === 'stopwatch') {
                if (timers[questionId] === undefined) {
                    timers[questionId] = 0; // Initialize stopwatch at 0 if not already
                }
                timerIntervals[questionId] = setInterval(() => {
                    timers[questionId]++;
                    timerDisplay.textContent = formatTime(timers[questionId]);
                }, 1000);
            } else { // Timer mode
                // If timer is being started for the first time or after a reset/stop
                if (timers[questionId] === undefined || timerIntervals[questionId] === null) {
                    const minutesInput = document.getElementById(`timer-minutes-${questionId}`);
                    const secondsInput = document.getElementById(`timer-seconds-${questionId}`);
                    const minutes = parseInt(minutesInput.value || 0);
                    const seconds = parseInt(secondsInput.value || 0);
                    timers[questionId] = minutes * 60 + seconds;
                    timerSetTimes[questionId] = timers[questionId]; // Capture initial set time
                }

                timerIntervals[questionId] = setInterval(() => {
                    if (timers[questionId] > 0) {
                        timers[questionId]--;
                        timerDisplay.textContent = formatTime(timers[questionId]);
                    } else {
                        // Once timer hits 0, start negative counting
                        timers[questionId]--;
                        timerDisplay.textContent = "-" + formatTime(Math.abs(timers[questionId]));
                        timerDisplay.classList.add('negative-time');
                    }
                }, 1000);
            }
        }

        function stopTimer(questionId) {
            clearInterval(timerIntervals[questionId]);
            timerIntervals[questionId] = null; // Clear the interval ID
        }

        function resetTimer(questionId) {
            stopTimer(questionId);
            const timerDisplay = document.getElementById(`timer-display-${questionId}`);
            if (!timerDisplay) {
                console.error(`Timer display for ${questionId} not found during reset.`);
                return;
            }
            timerDisplay.classList.remove('negative-time');

            if (timerTypes[questionId] === 'stopwatch') {
                timers[questionId] = 0;
                timerDisplay.textContent = "00:00";
            } else { // Timer mode
                const minutesInput = document.getElementById(`timer-minutes-${questionId}`);
                const secondsInput = document.getElementById(`timer-seconds-${questionId}`);
                const minutes = parseInt(minutesInput.value || 0);
                const seconds = parseInt(secondsInput.value || 0);
                timers[questionId] = minutes * 60 + seconds;
                timerSetTimes[questionId] = timers[questionId]; // Reset the initial set time as well
                timerDisplay.textContent = formatTime(timers[questionId]);
            }
        }

        function formatTime(totalSeconds) {
            const absSeconds = Math.abs(totalSeconds);
            const minutes = Math.floor(absSeconds / 60);
            const seconds = absSeconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function saveProgress(questionId, isCorrect) {
            const progress = JSON.parse(localStorage.getItem('greQuantProgress')) || [];
            let timeTakenSeconds = 0;
            let timeTypeString = 'N/A'; // Default
            let formattedTimeDisplay = 'N/A';

            if (timers[questionId] !== undefined) {
                if (timerTypes[questionId] === 'stopwatch') {
                    timeTakenSeconds = timers[questionId];
                    formattedTimeDisplay = formatTime(timeTakenSeconds);
                    timeTypeString = 'stopwatch';
                } else if (timerTypes[questionId] === 'timer') {
                    // Calculate time taken relative to the initial set time
                    timeTakenSeconds = timerSetTimes[questionId] - timers[questionId];

                    if (timers[questionId] < 0) { // If timer ran out and went negative
                        formattedTimeDisplay = "-" + formatTime(Math.abs(timers[questionId]));
                        timeTypeString = 'timer-negative';
                    } else { // If timer is still positive or exactly zero
                        formattedTimeDisplay = formatTime(timeTakenSeconds);
                        timeTypeString = 'timer-positive';
                    }
                }
            }

            const existingIndex = progress.findIndex(item => item.questionId === questionId);
            const newProgressItem = {
                questionId: questionId,
                isCorrect: isCorrect,
                timestamp: new Date().toLocaleString(),
                timeTakenSeconds: timeTakenSeconds, // Store raw seconds for potential analysis
                formattedTime: formattedTimeDisplay,
                timeType: timeTypeString
            };

            if (existingIndex > -1) {
                progress[existingIndex] = newProgressItem; // Update existing entry
            } else {
                progress.push(newProgressItem); // Add new entry
            }

            localStorage.setItem('greQuantProgress', JSON.stringify(progress));
            loadProgress(); // Reload and display progress
        }

        function loadProgress() {
            const progressList = document.getElementById('progress-list');
            progressList.innerHTML = ''; // Clear previous entries
            const progress = JSON.parse(localStorage.getItem('greQuantProgress')) || [];

            progress.forEach(item => {
                const p = document.createElement('p');
                p.className = 'progress-item';
                let status = item.isCorrect ? 'Correct' : 'Incorrect';
                let timeClass = 'time-taken'; // Default to green
                if (item.timeType === 'timer-negative') {
                    timeClass = 'negative-time-taken'; // Red for negative timer
                }

                p.innerHTML = `<strong>${item.questionId}:</strong> ${status} - Time: <span class="${timeClass}">${item.formattedTime || 'N/A'}</span> (Attempted: ${item.timestamp})`;
                progressList.appendChild(p);
            });
        }
    </script>

</body>
</html>
